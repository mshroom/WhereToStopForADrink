<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GraphController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">WhereToStopForADrink</a> &gt; <a href="index.source.html" class="el_package">control</a> &gt; <span class="el_source">GraphController.java</span></div><h1>GraphController.java</h1><pre class="source lang-java linenums">package control;

import dataStructures.Place;
import web.DistanceFinder;
import dataStructures.ObjectQueue;
import io.FileIO;
import web.AddressFinder;

/**
 * GraphController controls the graph and the places belonging to the graph, 
 * with the help of the PlaceController. Class contains methods to import and export
 * graph and place data.
 * @author mshroom
 */
public class GraphController {;
    private Place[] places;
    private DistanceFinder finder;
    private int[][] graph;
    private PlaceController placeController;
    
    /**
     * Create a GraphController with an empty graph.
     */
<span class="nc" id="L24">    public GraphController() {</span>
<span class="nc" id="L25">        this.finder = new DistanceFinder();</span>
<span class="nc" id="L26">        this.placeController = new PlaceController();</span>
<span class="nc" id="L27">    }</span>
    
    /**
     * Create a GraphController with a custom DistanceFinder, placeController and graph.
     * @param finder DistanceFinder object to be used with this GraphController
     * @param placeController PlaceController object to be used with this GraphControlelr
     * @param graph The graph in the form of a two-dimensional array. If the graph is not
     * empty it should correspond to the place list of the placeController.
     */
<span class="fc" id="L36">    public GraphController(DistanceFinder finder, PlaceController placeController, int[][] graph) {</span>
<span class="fc" id="L37">        this.finder = finder;</span>
<span class="fc" id="L38">        this.placeController = placeController;</span>
<span class="fc" id="L39">        this.graph = graph;</span>
<span class="fc" id="L40">    }</span>
    
    /**
     * Imports place data from a text file, finds the coordinates for the places and 
     * the distances between the places and uses the data to initialize the graph.
     * @param file The name of the file containing place data. 
     * Each row in the file must describe the place in the form &quot;Name;Address&quot; (without
     * the quotation marks).
     * @throws Exception If an error occurs while importing data.
     */
    public void importPlaces(String file) throws Exception {
<span class="fc" id="L51">        placeController.importPlaces(file);</span>
<span class="fc" id="L52">        this.places = placeController.getPlaces();</span>
<span class="fc" id="L53">        this.initializeGraph();</span>
<span class="fc" id="L54">    }</span>
    
    /**
     * Imports a saved graph and saved Place objects from text files.
     * @param placeFile The name of the file containing saved Places. Each row in the file must
     * contain a toString representation of a Place object.
     * @param graphFile The name of the file containing the saved graph. The file must be
     * consistent with the placeFile.
     * @throws Exception If an error occurs while importing data.
     */
    public void useSaved(String placeFile, String graphFile) throws Exception {
<span class="fc" id="L65">        placeController.useSavedPlaces(placeFile);</span>
<span class="fc" id="L66">        this.places = placeController.getPlaces();</span>
<span class="fc" id="L67">        this.fetchSavedGraph(graphFile);</span>
<span class="fc" id="L68">    }</span>
    
    /**
     * Saves the current graph into text files. These two text files must be used together next time 
     * when importing the saved data.
     * @param placeFile The name of the file for places. Note that the file must already exist.
     * @param graphFile The name of the file for the graph. Note that the file must already exist.
     * @throws Exception If an error occurs while saving data.
     */
    public void save(String placeFile, String graphFile) throws Exception {
<span class="fc" id="L78">        placeController.savePlaces(placeFile);</span>
<span class="fc" id="L79">        this.saveGraph(graphFile);</span>
<span class="fc" id="L80">    }</span>
    
    /**
     * Initializes the graph by finding the distances between places and creating
     * a two-dimensional array containing the distances.
     * @throws Exception If an error occurs while getting the distances.
     */
    private void initializeGraph() throws Exception {
<span class="fc" id="L88">        System.out.println(&quot;Getting distances...&quot;);</span>
<span class="fc" id="L89">        int total = places.length;</span>
<span class="fc" id="L90">        this.graph = new int[places.length][places.length];</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">        for (int i = 0; i &lt; graph.length; i ++) {</span>
<span class="fc" id="L92">            System.out.println(&quot;Progress: &quot; + i + &quot;/&quot; + total);</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">            for (int j = 0; j &lt; graph.length; j ++) {</span>
<span class="fc" id="L94">                Place a = places[i];</span>
<span class="fc" id="L95">                Place b = places[j];</span>
<span class="fc bfc" id="L96" title="All 4 branches covered.">                if (graph[j][i] == 0 &amp;&amp; i != j) {</span>
<span class="fc" id="L97">                    int length = this.finder.findDistance(a.getX(), a.getY(), b.getX(), b.getY());</span>
<span class="fc" id="L98">                    graph[i][j] = length;                    </span>
<span class="fc" id="L99">                } else {</span>
<span class="fc" id="L100">                    graph[i][j] = graph[j][i];</span>
                }
            }
        }
<span class="fc" id="L104">    }</span>
    
    /**
     * Saves the current graph to a text file.
     * @param file The name of the file.
     * @throws Exception If an error occurs while saving data.
     */
    private void saveGraph(String file) throws Exception {
<span class="fc" id="L112">        FileIO io = new FileIO(file);</span>
<span class="fc" id="L113">        io.clear();</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">        for (int i = 0; i &lt; this.graph.length; i ++) {</span>
<span class="fc" id="L115">            String write = &quot;&quot;;</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">            for (int j = 0; j &lt; this.graph[i].length; j ++) {</span>
<span class="fc" id="L117">                write += this.graph[i][j];</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">                if (j &lt; this.graph[i].length - 1) {</span>
<span class="fc" id="L119">                    write += &quot;;&quot;;</span>
                }
            }
<span class="fc" id="L122">            io.printLine(write);</span>
        }        
<span class="fc" id="L124">    }</span>
    
    /**
     * Imports a saved graph from a text file.
     * @param file The name of the file.
     * @throws Exception If an error occurs while importing data.
     */
    private void fetchSavedGraph(String file) throws Exception {        
<span class="fc" id="L132">        FileIO io = new FileIO(file);</span>
        while (true) {            
<span class="fc" id="L134">            String p = io.readLine(&quot;&quot;);</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">            if (p.equals(&quot;&quot;)) {</span>
<span class="fc" id="L136">                break;</span>
            }
<span class="fc" id="L138">            String[] rows = p.split(&quot;\\|\\|&quot;);  </span>
<span class="fc" id="L139">            int[][] savedGraph = new int[rows.length][rows.length];</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">            for (int i = 0; i &lt; rows.length; i ++) {</span>
<span class="fc" id="L141">                String row = rows[i];</span>
<span class="fc" id="L142">                String[] distances = row.split(&quot;;&quot;);</span>
<span class="fc bfc" id="L143" title="All 2 branches covered.">                for (int j = 0; j &lt; distances.length; j ++) {</span>
<span class="fc" id="L144">                    savedGraph[i][j] = Integer.parseInt(distances[j]);</span>
                }
            }
<span class="fc" id="L147">            this.graph = savedGraph;</span>
<span class="fc" id="L148">        }       </span>
<span class="fc" id="L149">    }</span>

    public int[][] getGraph() {
<span class="fc" id="L152">        return this.graph;</span>
    }
    
    /**
     * Returns an array containing the distances from the given node to all other nodes.
     * @param index The index of the wanted node.
     * @return An array where the indexes of the array correspond to the indexes of the nodes 
     * and in each index is the distance to the given node.
     */
    public int[] getDistances(int index) {
<span class="nc" id="L162">        return this.graph[index];</span>
    }
    
    /**
     * Returns the place with the given index.
     * @param index The index of the place
     * @return The Place object with that index, null if there is no such index.
     */
    public Place getPlace(int index) {
<span class="nc bnc" id="L171" title="All 4 branches missed.">        if (index &gt;= 0 &amp;&amp; index &lt; this.places.length) {</span>
<span class="nc" id="L172">            return this.places[index];</span>
        }
<span class="nc" id="L174">        return null;</span>
    }
    
    /**
     * Creates a reduced graph from the current graph, where each edge that is longer
     * than the given maximum distance, will be removed.
     * @param maximumDistance The maximum distance; longer edges will be removed.
     * @return The reduced graph where longer edges have been removed.
     */
    public int[][] getReducedGraph(int maximumDistance) {
<span class="fc" id="L184">        int[][] ret = new int[this.graph.length][this.graph.length];</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">        for (int i = 0; i &lt; ret.length; i ++) {</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">            for (int j = 0; j &lt; ret.length; j ++) {</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">                if (this.graph[i][j] &lt;= maximumDistance) {</span>
<span class="fc" id="L188">                    ret[i][j] = this.graph[i][j];</span>
                } else {
<span class="fc" id="L190">                    ret[i][j] = -1;</span>
                }
            }
        }
<span class="fc" id="L194">        return ret;</span>
    }
    
    /**
     * Creates a smaller graph consisting of given amount of nodes.
     * @param maximumNumber The maximum amount of nodes.
     * @return The reduced graph in which the rest of the nodes have been removed.
     */
    public int[][] getSmallerGraph(int maximumNumber) {
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">        if (maximumNumber &gt; this.graph.length) {</span>
<span class="nc" id="L204">            return this.graph;</span>
        }
<span class="fc" id="L206">        int[][] smaller = new int[maximumNumber][maximumNumber];</span>
<span class="fc bfc" id="L207" title="All 2 branches covered.">        for (int i = 0; i &lt; smaller.length; i ++) {</span>
<span class="fc bfc" id="L208" title="All 2 branches covered.">            for (int j = 0; j &lt; smaller.length; j ++) {</span>
<span class="fc" id="L209">                smaller[i][j] = graph[i][j];</span>
            }
        }
<span class="fc" id="L212">        return smaller;</span>
    }
    
    /**
     * Returns the amount of nodes in the current graph.
     * @return The amount of nodes.
     */
    public int getSizeOfCurrentGraph() {
<span class="nc" id="L220">        return this.graph.length;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>